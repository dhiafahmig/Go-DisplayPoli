<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Poli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
    <script src="https://kit.fontawesome.com/3b5b58c4f5.js" crossorigin="anonymous"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes blink-animation {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        .blink {
            animation: blink-animation 1.5s infinite;
        }
        
        .gradient-header {
            background: linear-gradient(to right, #3b82f6, #1e40af);
        }
        
        .card-gradient {
            background-image: linear-gradient(135deg, #f5f7fa 0%, #e4e8ed 100%);
        }
        
        .custom-shadow {
            box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.1), 0 8px 10px -6px rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans">
    <!-- Header -->
    <div class="gradient-header text-white shadow-lg py-4">
        <div class="container mx-auto px-6">
            <div class="flex flex-col items-center justify-between md:flex-row">
                <div class="flex items-center mb-4 md:mb-0">
                    <i class="fas fa-hospital text-4xl mr-3"></i>
                    <h1 class="text-3xl font-bold tracking-tight">DISPLAY ANTRIAN POLI</h1>
                </div>
                <div>
                    <h3 id="jam" class="text-xl font-light"></h3>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="container mx-auto px-6 py-10">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-20">
            {{range $index, $poli := .PoliList}}
            <div id="poli-card-{{$poli.kd_ruang_poli}}" class="bg-white rounded-xl custom-shadow overflow-hidden transform hover:scale-[1.02] transition-all duration-300">
                <div class="gradient-header text-white py-5 px-6">
                    <div class="flex items-center justify-center">
                        <i class="fas fa-stethoscope text-xl mr-3"></i>
                        <h2 class="text-2xl font-semibold">{{$poli.nama_ruang_poli}}</h2>
                    </div>
                </div>
                <div class="p-6 text-center card-gradient">
                    {{if $poli.getPasien}}
                        {{range $pasien := $poli.getPasien}}
                        <div class="mb-5">
                            <div class="flex items-center justify-center mb-2">
                                <i class="fas fa-user-alt text-blue-500 mr-2"></i>
                                <p class="text-gray-700 text-lg font-medium">Pasien:</p>
                            </div>
                            <div class="bg-white rounded-lg py-3 px-4 shadow-inner">
                                <p class="text-gray-800 text-2xl font-medium">{{$pasien.nm_pasien}}</p>
                            </div>
                        </div>
                        <div class="mt-8">
                            <div class="flex items-center justify-center mb-2">
                                <i class="fas fa-ticket-alt text-blue-500 mr-2"></i>
                                <p class="text-gray-700 text-lg font-medium">No. Antrian:</p>
                            </div>
                            <div class="bg-blue-50 rounded-lg py-4 shadow-inner">
                                <p class="text-blue-600 text-5xl font-bold blink">{{$pasien.no_reg}}</p>
                            </div>
                        </div>
                        {{end}}
                    {{else}}
                        <div class="py-16 flex flex-col items-center">
                            <i class="far fa-calendar-times text-5xl text-gray-400 mb-4"></i>
                            <p class="text-2xl text-gray-500">Tidak ada pasien</p>
                        </div>
                    {{end}}
                </div>
            </div>
            {{end}}
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white py-4 text-center text-gray-600 fixed bottom-0 w-full shadow-md">
        <div class="container mx-auto">
            <div class="flex items-center justify-center">
                <i class="far fa-copyright mr-2"></i>
                <p>2023 Sistem Antrian Poli</p>
            </div>
        </div>
    </footer>

    <script>
        // Update jam
        function updateClock() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            document.getElementById('jam').textContent = now.toLocaleDateString('id-ID', options);
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Setup WebSocket
        const socket = new WebSocket('ws://{{.AppURL}}/ws/{{.KdDisplay}}');
        
        socket.onopen = function(e) {
            console.log('WebSocket connection established');
        };
        
        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            if (data.kd_display === '{{.KdDisplay}}') {
                handlePanggilan(data);
            }
        };
        
        socket.onclose = function(event) {
            if (event.wasClean) {
                console.log('WebSocket connection closed cleanly');
            } else {
                console.error('WebSocket connection died');
            }
            // Mencoba menyambung kembali setelah 5 detik
            setTimeout(function() {
                window.location.reload();
            }, 5000);
        };
        
        socket.onerror = function(error) {
            console.error('WebSocket Error: ', error);
        };

        // Handle panggilan pasien
        function handlePanggilan(data) {
            const poliCard = document.getElementById('poli-card-' + data.kd_ruang_poli);
            if (poliCard) {
                const cardBody = poliCard.querySelector('div:nth-child(2)');
                cardBody.innerHTML = `
                    <div class="mb-5">
                        <div class="flex items-center justify-center mb-2">
                            <i class="fas fa-user-alt text-blue-500 mr-2"></i>
                            <p class="text-gray-700 text-lg font-medium">Pasien:</p>
                        </div>
                        <div class="bg-white rounded-lg py-3 px-4 shadow-inner">
                            <p class="text-gray-800 text-2xl font-medium">${data.nm_pasien}</p>
                        </div>
                    </div>
                    <div class="mt-8">
                        <div class="flex items-center justify-center mb-2">
                            <i class="fas fa-ticket-alt text-blue-500 mr-2"></i>
                            <p class="text-gray-700 text-lg font-medium">No. Antrian:</p>
                        </div>
                        <div class="bg-blue-50 rounded-lg py-4 shadow-inner">
                            <p class="text-blue-600 text-5xl font-bold blink">${data.no_reg}</p>
                        </div>
                    </div>
                `;
                
                // Mainkan suara notifikasi
                const audio = new Audio('/assets/notification.mp3');
                audio.play();
                
                // Efek panggilan (highlight card)
                poliCard.classList.add('ring-4', 'ring-blue-500', 'ring-opacity-50');
                setTimeout(() => {
                    poliCard.classList.remove('ring-4', 'ring-blue-500', 'ring-opacity-50');
                }, 5000);
            }
        }
    </script>
</body>
</html> 